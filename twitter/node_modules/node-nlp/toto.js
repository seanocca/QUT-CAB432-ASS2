const fs = require('fs');
const result = {
  name: 'BigChatbot',
  lang: 'en',
  sentences : [],
};

function normalize(s) {
  let result = s.replace('\\?', '?');
  result = result.replace('\r', '');
  return result;
}

const train = fs.readFileSync('./train_full.txt', 'utf8').split('\n');
train.forEach(line => {
  const i = line.indexOf('__label__');
  if (i > -1) {
    const text = normalize(line.substring(0, i - 1));
    const intent = normalize(line.substring(i + 9));
    result.sentences.push({
      text,
      intent,
      training: true,
      entities: [],
    });
  }
});

const test = fs.readFileSync('./train_full.txt', 'utf8').split('\n\r');
test.forEach(line => {
  const i = line.indexOf('__label__');
  if (i > -1) {
    const text = normalize(line.substring(0, i - 1));
    const intent = normalize(line.substring(i + 9).split('\r')[0].trim());
    result.sentences.push({
      text,
      intent,
      training: false,
      entities: [],
    });
  }
});

fs.writeFileSync('BigChatbotCorpus.json', JSON.stringify(result, null, 2), 'utf8');
